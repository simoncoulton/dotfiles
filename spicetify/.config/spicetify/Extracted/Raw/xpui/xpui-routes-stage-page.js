"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{73338:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Z});var n=a(77),r=a(39733),i=a(41331),o=a(21560),s=a(7029),c=a(36809);var l=a(30758),u=a(97500),d=a.n(u),g=a(70329);const h="NWSmcn03uY8Fosh_mYCi",I="N9ngMcd9oSDEd8zK5jBj",N="kYOJhuJ996EIMXFJD3By";var f=a(17504),p=a(20078),T=a(22594);const E=p.$S.PANEL_CLOSE_CLICK;const b=(0,a(15348).h)(),y="sp://auth/v1/token_web_auth";async function C(e){if(!e)return;const t=new URL(y);return t.searchParams.append("audience",e),await b.get(t.toString())}var k=a(41978);function O(e,t){const a=(0,l.useRef)(),r=(0,l.useMemo)((()=>new AbortController),[]),{signal:i}=r,o=function(){const e=(0,n.Zp)(),t=(0,k.d4)((e=>e.ui.history.canGoBack));return(0,l.useCallback)((()=>{e(t?-1:"/")}),[e,t])}(),s=(0,l.useCallback)((n=>{if(!e||!e.includes(n.origin))return;const r=JSON.parse(n.data);"didRequestInitialize"===r.type?(a.current={source:n.source,options:{targetOrigin:n.origin}},function(e){const{source:t,options:a}=e,n=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(n,a)}(a.current)):"didRequestIDToken"===r.type?(a.current={source:n.source,options:{targetOrigin:n.origin}},async function(e,t){const{source:a,options:n}=e,r=await C(t);if(!r)return;if(!r.accessToken)return;const i=JSON.stringify({type:"didReceiveIDToken",token:r.accessToken});a.postMessage(i,n)}(a.current,t)):"didRequestClose"===r.type&&o()}),[e,t,o]);(0,l.useEffect)((()=>{if(e)return window.addEventListener("message",(e=>s(e)),{signal:i}),()=>{r.abort()}}),[e,r,s,i])}var D=a(69180);var S=a(2569);let L=function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function v(e){switch(e){case 0:case"NONE":return L.NONE;case 1:case"STT":return L.STT;case 2:case"IDT":return L.IDT;default:return L.UNRECOGNIZED}}let w=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function A(e){switch(e){case 0:case"INVALID":return w.INVALID;case 1:case"VALID":return w.VALID;case 2:case"ACTIVE":return w.ACTIVE;default:return w.UNRECOGNIZED}}let m=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});const R={fromJSON:e=>({id:P(e.id)?globalThis.String(e.id):"0",campaignId:P(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:P(e.lookupToken)?globalThis.String(e.lookupToken):"",url:P(e.url)?globalThis.String(e.url):"",authType:P(e.authType)?v(e.authType):0,clientId:P(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!P(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:P(e.status)?A(e.status):0,restricted:!!P(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:P(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:P(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(e?.restrictions)?e.restrictions.map((e=>function(e){switch(e){case 0:case"ALCOHOL":return m.ALCOHOL;case 1:case"ENERGY_DRINKS":return m.ENERGY_DRINKS;default:return m.UNRECOGNIZED}}(e))):[],enableLegacySharing:!!P(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!P(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!P(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!P(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(e?.allowedCountries)?e.allowedCountries.map((e=>globalThis.String(e))):[],restoreOnKilled:!!P(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!P(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.campaignId&&(t.campaignId=e.campaignId),""!==e.lookupToken&&(t.lookupToken=e.lookupToken),""!==e.url&&(t.url=e.url),0!==e.authType&&(t.authType=function(e){switch(e){case L.NONE:return"NONE";case L.STT:return"STT";case L.IDT:return"IDT";case L.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.authType)),void 0!==e.clientId&&(t.clientId=e.clientId),!1!==e.hasAudio&&(t.hasAudio=e.hasAudio),0!==e.status&&(t.status=function(e){switch(e){case w.INVALID:return"INVALID";case w.VALID:return"VALID";case w.ACTIVE:return"ACTIVE";case w.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.status)),!1!==e.restricted&&(t.restricted=e.restricted),""!==e.gcpProjectId&&(t.gcpProjectId=e.gcpProjectId),""!==e.defaultLocale&&(t.defaultLocale=e.defaultLocale),e.restrictions?.length&&(t.restrictions=e.restrictions.map((e=>function(e){switch(e){case m.ALCOHOL:return"ALCOHOL";case m.ENERGY_DRINKS:return"ENERGY_DRINKS";case m.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e)))),!1!==e.enableLegacySharing&&(t.enableLegacySharing=e.enableLegacySharing),!1!==e.hidePlayer&&(t.hidePlayer=e.hidePlayer),!1!==e.legacyBackBehavior&&(t.legacyBackBehavior=e.legacyBackBehavior),!1!==e.enableCheckout&&(t.enableCheckout=e.enableCheckout),e.allowedCountries?.length&&(t.allowedCountries=e.allowedCountries),!1!==e.restoreOnKilled&&(t.restoreOnKilled=e.restoreOnKilled),!1!==e.enableMediaDevices&&(t.enableMediaDevices=e.enableMediaDevices),t},create:e=>R.fromPartial(e??{}),fromPartial(e){const t={id:"0",campaignId:"0",lookupToken:"",url:"",authType:0,clientId:void 0,hasAudio:!1,status:0,restricted:!1,gcpProjectId:"",defaultLocale:"",restrictions:[],enableLegacySharing:!1,hidePlayer:!1,legacyBackBehavior:!1,enableCheckout:!1,allowedCountries:[],restoreOnKilled:!1,enableMediaDevices:!1};return t.id=e.id??"0",t.campaignId=e.campaignId??"0",t.lookupToken=e.lookupToken??"",t.url=e.url??"",t.authType=e.authType??0,t.clientId=e.clientId??void 0,t.hasAudio=e.hasAudio??!1,t.status=e.status??0,t.restricted=e.restricted??!1,t.gcpProjectId=e.gcpProjectId??"",t.defaultLocale=e.defaultLocale??"",t.restrictions=e.restrictions?.map((e=>e))||[],t.enableLegacySharing=e.enableLegacySharing??!1,t.hidePlayer=e.hidePlayer??!1,t.legacyBackBehavior=e.legacyBackBehavior??!1,t.enableCheckout=e.enableCheckout??!1,t.allowedCountries=e.allowedCountries?.map((e=>e))||[],t.restoreOnKilled=e.restoreOnKilled??!1,t.enableMediaDevices=e.enableMediaDevices??!1,t}};const B={fromJSON:e=>({site:P(e.site)?R.fromJSON(e.site):void 0}),toJSON(e){const t={};return void 0!==e.site&&(t.site=R.toJSON(e.site)),t},create:e=>B.fromPartial(e??{}),fromPartial(e){const t={site:void 0};return t.site=void 0!==e.site&&null!==e.site?R.fromPartial(e.site):void 0,t}};function P(e){return null!=e}var G=a(76629);var V=a(93409);const K=e=>{const t=[e],{data:a,isLoading:n,isError:r}=(0,S.I)({queryKey:t,queryFn:async()=>await(async(e,t)=>await e.build().withHost(`${G.sp}`).withMethod("GET").withoutMarket().withPath(`/site/${t}`).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then((e=>({...e,body:B.fromJSON(e.body)}))))(V.n.getInstance(),e),staleTime:6e5,gcTime:18e5});return{data:a?.body.site,loading:n,error:r}};var U=a(19019),M=a(86070);const Z=e=>{const{lookupToken:t=""}=(0,n.g)(),{data:a,loading:u,error:p}=K(t);O(a?.url,a?.clientId);const b=function(e){const[t,a]=(0,l.useState)(""),n=(0,l.useCallback)((async()=>{const t=await C(e);t&&a(t.accessToken)}),[e]);return(0,l.useEffect)((()=>{e&&n()}),[e,n]),t}(a?.clientId),y=(()=>{const e=(0,c.k)();if(!e)return;const{containerVersion:t}=e;return t.substring(0,t.lastIndexOf("."))})();(()=>{const{scrollNodeChildRef:e}=(0,l.useContext)(g.bi);(0,l.useEffect)((()=>{const t=e?.current,a=e?.current?.className;return t&&(t.className=d()(a,N)),()=>{t&&(t.className=d()(a))}}),[e])})(),(()=>{const{isActive:e,panelSend:t}=(0,f.AI)(T.Z.NowPlayingView);e&&t(E)})(),function(){const e=(0,D.z)();e.getState()?.hasContext&&!e.getState()?.isPaused&&e.pause()}();const k=(0,r.NC)(U.n2U);if(u||!k||!y||!a||!b)return(0,M.jsx)(s.A,{hasError:p,errorMessage:i.Ru.get("error.generic")});const S=function(e,t,a){const n=new URL(e);n.searchParams.append("utm_app_version",t),a&&(n.hash=`#id_token=${a}`);return n.toString()}(a.url,y,b);return(0,M.jsx)(o.s,{children:(0,M.jsx)("div",{className:h,children:(0,M.jsx)("iframe",{title:i.Ru.get("web-player.the-stage.title"),name:"stage-view-frame",id:I,src:S,sandbox:"allow-scripts allow-same-origin"})})})}},36809:(e,t,a)=>{a.d(t,{k:()=>i});var n=a(30758),r=a(94010);function i(){const e=(0,r.t)(),[t,a]=(0,n.useState)(null);return(0,n.useEffect)((()=>{let t=!0;return e.getVersionInfo().then((e=>{t&&a(e)})),()=>{t=!1}}),[e,a]),t}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map